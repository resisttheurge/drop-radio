# This file is generated by Nx.
#
# Build the docker image with `npx nx docker-build @drop-radio/server`.
# Tip: Modify "docker-build" options in project.json to change docker build args.
#
# Run the container with `docker run -p 3000:3000 -t drop-radio-server`.
FROM docker.io/node:lts-alpine

# install ffmpeg
RUN apk upgrade -U \ 
    && apk add ca-certificates ffmpeg libva-intel-driver \
    && rm -rf /var/cache/*

WORKDIR /drop-radio/server

RUN mkdir input \
    && mkdir output

COPY dist/main.js .

RUN addgroup --system drop-radio-server && \
          adduser --system -G drop-radio-server drop-radio-server

RUN chown -R drop-radio-server:drop-radio-server .

ENV HOST="0.0.0.0" 
ENV PORT=3000 
ENV NODE_ENV="production"
ENV INPUT_DIRECTORY=/drop-radio/server/input 
ENV OUTPUT_DIRECTORY=/drop-radio/server/output
ENV START=2001-09-11T08:46:40Z

CMD [ "node", "main.js" ]
